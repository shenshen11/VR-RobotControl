# è§†é¢‘æµæ¸²æŸ“åˆ°VRçš„å®Œæ•´æµç¨‹

## ğŸ“Š ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VR è™šæ‹Ÿæœºå™¨äººç³»ç»Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœåŠ¡å™¨ç«¯ (Python)                          å®¢æˆ·ç«¯ (JavaScript)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PyBullet ç‰©ç†ä»¿çœŸ    â”‚                  â”‚   WebXR VR åœºæ™¯      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è™šæ‹Ÿæœºå™¨äºº      â”‚  â”‚                  â”‚  â”‚  Three.js      â”‚  â”‚
â”‚  â”‚ - äººå½¢æœºå™¨äºº    â”‚  â”‚                  â”‚  â”‚  - VR ç›¸æœº     â”‚  â”‚
â”‚  â”‚ - å½©è‰²ç«‹æ–¹ä½“    â”‚  â”‚                  â”‚  â”‚  - è§†é¢‘å±å¹•    â”‚  â”‚
â”‚  â”‚ - åœ°é¢         â”‚  â”‚                  â”‚  â”‚  - æ‰‹æŸ„        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“            â”‚                  â”‚         â†‘            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åŒç›®ç›¸æœºæ¸²æŸ“    â”‚  â”‚                  â”‚  â”‚ Shader æ‹†åˆ†    â”‚  â”‚
â”‚  â”‚ - å·¦çœ¼å›¾åƒ      â”‚  â”‚                  â”‚  â”‚ - å·¦çœ¼çº¹ç†     â”‚  â”‚
â”‚  â”‚ - å³çœ¼å›¾åƒ      â”‚  â”‚                  â”‚  â”‚ - å³çœ¼çº¹ç†     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“            â”‚                  â”‚         â†‘            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   WebRTC P2P    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Side-by-Side   â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’â”‚ è§†é¢‘æµæ¥æ”¶      â”‚  â”‚
â”‚  â”‚ è§†é¢‘æ‹¼æ¥        â”‚  â”‚   (å•è½¨é“)       â”‚  â”‚                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“            â”‚                  â”‚         â†‘            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WebRTC ç¼–ç     â”‚  â”‚                  â”‚  â”‚ WebRTC è§£ç     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                          â†‘
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç½‘ç»œä¼ è¾“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ è§†é¢‘æ¸²æŸ“æµç¨‹è¯¦è§£

### ç¬¬ä¸€æ­¥ï¼šPyBullet åœºæ™¯æ¸²æŸ“ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

#### 1.1 åœºæ™¯å†…å®¹ï¼ˆ`robot_sim.py`ï¼‰

**è™šæ‹Ÿæœºå™¨äººåœºæ™¯åŒ…å«ï¼š**

```python
# 1. åœ°é¢
self.plane_id = p.loadURDF("plane.urdf")

# 2. äººå½¢æœºå™¨äººï¼ˆhumanoidï¼‰
self.robot_id = p.loadURDF(
    "humanoid/humanoid.urdf",
    [0, 0, 0.9],  # åˆå§‹ä½ç½®ï¼šç¦»åœ°é¢ 0.9 ç±³
    useFixedBase=False
)

# 3. å››ä¸ªå½©è‰²ç«‹æ–¹ä½“ï¼ˆç¯ç»•æœºå™¨äººï¼‰
cube_positions = [
    [1, 0, 0.5],   # å‰æ–¹ - çº¢è‰²
    [0, 1, 0.5],   # å·¦ä¾§ - ç»¿è‰²
    [-1, 0, 0.5],  # åæ–¹ - è“è‰²
    [0, -1, 0.5]   # å³ä¾§ - é»„è‰²
]
```

**åœºæ™¯å¸ƒå±€ï¼š**
```
        ç»¿è‰²ç«‹æ–¹ä½“
            â”‚
            â”‚
è“è‰²ç«‹æ–¹ä½“ â”€â”¼â”€ æœºå™¨äºº â”€ çº¢è‰²ç«‹æ–¹ä½“
            â”‚
            â”‚
        é»„è‰²ç«‹æ–¹ä½“
            â”‚
        â”€â”€â”€åœ°é¢â”€â”€â”€
```

#### 1.2 åŒç›®ç›¸æœºæ¸²æŸ“ï¼ˆ`stereo_camera.py`ï¼‰

**å…³é”®å‚æ•°ï¼š**
- åˆ†è¾¨ç‡ï¼š640Ã—480ï¼ˆæ¯åªçœ¼ç›ï¼‰
- è§†åœºè§’ï¼ˆFOVï¼‰ï¼š90Â°
- ç³è·ï¼ˆIPDï¼‰ï¼š64mmï¼ˆæ¨¡æ‹Ÿäººçœ¼é—´è·ï¼‰

**æ¸²æŸ“è¿‡ç¨‹ï¼š**

```python
def render_stereo(self):
    # 1. è·å–æœºå™¨äººå¤´éƒ¨ä½ç½®å’Œæœå‘
    head_pos, head_orn = self.robot_sim.get_head_pose()
    
    # 2. å°†å››å…ƒæ•°è½¬æ¢ä¸ºæ—‹è½¬çŸ©é˜µ
    rotation_matrix = p.getMatrixFromQuaternion(head_orn)
    
    # 3. è®¡ç®—æ–¹å‘å‘é‡
    forward = rotation_matrix @ [1, 0, 0]  # å‰æ–¹
    up = rotation_matrix @ [0, 0, 1]       # ä¸Šæ–¹
    right = rotation_matrix @ [0, -1, 0]   # å³æ–¹
    
    # 4. è®¡ç®—å·¦çœ¼ä½ç½®ï¼ˆå‘å·¦åç§» 32mmï¼‰
    left_eye_pos = head_pos - right * 0.032
    
    # 5. è®¡ç®—å³çœ¼ä½ç½®ï¼ˆå‘å³åç§» 32mmï¼‰
    right_eye_pos = head_pos + right * 0.032
    
    # 6. æ¸²æŸ“å·¦çœ¼å›¾åƒ
    left_img = p.getCameraImage(
        width=640, height=480,
        viewMatrix=left_view_matrix,
        projectionMatrix=self.projection_matrix
    )
    
    # 7. æ¸²æŸ“å³çœ¼å›¾åƒ
    right_img = p.getCameraImage(
        width=640, height=480,
        viewMatrix=right_view_matrix,
        projectionMatrix=self.projection_matrix
    )
    
    return left_img, right_img
```

**ç«‹ä½“è§†è§‰åŸç†ï¼š**
```
        å·¦çœ¼è§†è§’          å³çœ¼è§†è§’
           â†“                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸŸ¥      â”‚      â”‚      ğŸŸ¥  â”‚  â† çº¢è‰²ç«‹æ–¹ä½“
    â”‚          â”‚      â”‚          â”‚    ï¼ˆè§†å·®äº§ç”Ÿæ·±åº¦æ„Ÿï¼‰
    â”‚    ğŸ¤–    â”‚      â”‚    ğŸ¤–    â”‚  â† æœºå™¨äºº
    â”‚          â”‚      â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     640Ã—480           640Ã—480
```

---

### ç¬¬äºŒæ­¥ï¼šSide-by-Side æ‹¼æ¥ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

#### 2.1 å›¾åƒæ‹¼æ¥ï¼ˆ`stereo_camera.py`ï¼‰

```python
def render_stereo_sbs(self):
    # 1. æ¸²æŸ“å·¦å³çœ¼å›¾åƒ
    left_img, right_img = self.render_stereo()
    
    # 2. æ°´å¹³æ‹¼æ¥
    sbs_img = np.hstack([left_img, right_img])
    
    # è¾“å‡ºå°ºå¯¸ï¼š1280Ã—480
    return sbs_img
```

**æ‹¼æ¥ç»“æœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¦çœ¼å›¾åƒ (640Ã—480) â”‚ å³çœ¼å›¾åƒ (640Ã—480) â”‚
â”‚                    â”‚                    â”‚
â”‚      ğŸŸ¥            â”‚            ğŸŸ¥      â”‚
â”‚                    â”‚                    â”‚
â”‚        ğŸ¤–          â”‚          ğŸ¤–        â”‚
â”‚                    â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Side-by-Side æ ¼å¼ (1280Ã—480)
```

---

### ç¬¬ä¸‰æ­¥ï¼šWebRTC è§†é¢‘ä¼ è¾“

#### 3.1 è§†é¢‘ç¼–ç ï¼ˆ`webrtc_server.py`ï¼‰

```python
class RobotVideoTrack(VideoStreamTrack):
    async def recv(self):
        # 1. æ¸²æŸ“ Side-by-Side å›¾åƒ
        sbs_img = self.camera.render_stereo_sbs()
        
        # 2. è½¬æ¢ä¸º VideoFrame
        frame = VideoFrame.from_ndarray(sbs_img, format='bgr24')
        frame.pts = self.pts
        frame.time_base = fractions.Fraction(1, 1000000)
        
        # 3. è¿”å›ç»™ WebRTC ç¼–ç å™¨
        return frame
```

#### 3.2 ç½‘ç»œä¼ è¾“

- **åè®®**ï¼šWebRTC P2P
- **ç¼–ç **ï¼šVP8/VP9/H.264ï¼ˆæµè§ˆå™¨è‡ªåŠ¨é€‰æ‹©ï¼‰
- **ä¼ è¾“**ï¼šå•ä¸ªè§†é¢‘è½¨é“ï¼ˆ1280Ã—480ï¼‰
- **å»¶è¿Ÿ**ï¼š< 100ms

---

### ç¬¬å››æ­¥ï¼šå®¢æˆ·ç«¯æ¥æ”¶å’Œè§£ç 

#### 4.1 WebRTC æ¥æ”¶ï¼ˆ`webrtc-client.js`ï¼‰

```javascript
pc.ontrack = (event) => {
    const stream = event.streams[0];
    
    // Side-by-Side æ¨¡å¼ï¼šåªæ¥æ”¶ä¸€ä¸ªè§†é¢‘è½¨é“
    if (this.videoMode === 'sbs') {
        this.onVideoTrack(stream);
    }
};
```

#### 4.2 åˆ›å»ºè§†é¢‘å…ƒç´ ï¼ˆ`vr-scene.js`ï¼‰

```javascript
setupStereoVideoSBS(stream) {
    // 1. åˆ›å»º HTML5 è§†é¢‘å…ƒç´ 
    const video = document.createElement('video');
    video.srcObject = stream;
    video.autoplay = true;
    video.play();
    
    // 2. åˆ›å»º Three.js è§†é¢‘çº¹ç†
    const videoTexture = new THREE.VideoTexture(video);
    
    // è§†é¢‘çº¹ç†åŒ…å«å®Œæ•´çš„ Side-by-Side å›¾åƒ (1280Ã—480)
}
```

---

### ç¬¬äº”æ­¥ï¼šShader æ‹†åˆ†å’Œæ¸²æŸ“

#### 5.1 Shader æ‹†åˆ†ï¼ˆ`stereo-shader.js`ï¼‰

**æ ¸å¿ƒåŸç†ï¼šé€šè¿‡ UV åæ ‡æ˜ å°„ï¼Œä»å•ä¸ªçº¹ç†ä¸­é‡‡æ ·ä¸åŒåŒºåŸŸ**

```glsl
// Fragment Shader
uniform sampler2D videoTexture;  // å®Œæ•´çš„ SBS çº¹ç† (1280Ã—480)
uniform int eyeIndex;            // 0=å·¦çœ¼, 1=å³çœ¼

varying vec2 vUv;  // UV åæ ‡ (0.0 ~ 1.0)

void main() {
    vec2 uv = vUv;
    
    if (eyeIndex == 0) {
        // å·¦çœ¼ï¼šé‡‡æ ·å·¦åŠéƒ¨åˆ†
        // å°† U åæ ‡ä» [0.0, 1.0] æ˜ å°„åˆ° [0.0, 0.5]
        uv.x = uv.x * 0.5;
    } else {
        // å³çœ¼ï¼šé‡‡æ ·å³åŠéƒ¨åˆ†
        // å°† U åæ ‡ä» [0.0, 1.0] æ˜ å°„åˆ° [0.5, 1.0]
        uv.x = uv.x * 0.5 + 0.5;
    }
    
    gl_FragColor = texture2D(videoTexture, uv);
}
```

**UV æ˜ å°„ç¤ºæ„å›¾ï¼š**
```
Side-by-Side çº¹ç† (1280Ã—480)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¦çœ¼ (0.0~0.5)  â”‚  å³çœ¼ (0.5~1.0)  â”‚
â”‚                  â”‚                  â”‚
â”‚      ğŸŸ¥          â”‚          ğŸŸ¥      â”‚
â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  U: 0.0    0.5    0.5           1.0

å·¦çœ¼ Shader:                å³çœ¼ Shader:
uv.x = uv.x * 0.5          uv.x = uv.x * 0.5 + 0.5
é‡‡æ · [0.0, 0.5]            é‡‡æ · [0.5, 1.0]
```

#### 5.2 åˆ›å»ºåŒå±å¹•ï¼ˆ`vr-scene.js`ï¼‰

```javascript
// å·¦çœ¼å±å¹•
const leftMaterial = new THREE.ShaderMaterial({
    uniforms: {
        videoTexture: { value: videoTexture },
        eyeIndex: { value: 0 }  // å·¦çœ¼
    },
    vertexShader: StereoVideoShaderSBS.vertexShader,
    fragmentShader: StereoVideoShaderSBS.fragmentShader
});

this.leftScreen = new THREE.Mesh(geometry, leftMaterial);
this.leftScreen.layers.set(1);  // å›¾å±‚ 1
this.scene.add(this.leftScreen);

// å³çœ¼å±å¹•
const rightMaterial = new THREE.ShaderMaterial({
    uniforms: {
        videoTexture: { value: videoTexture },
        eyeIndex: { value: 1 }  // å³çœ¼
    },
    vertexShader: StereoVideoShaderSBS.vertexShader,
    fragmentShader: StereoVideoShaderSBS.fragmentShader
});

this.rightScreen = new THREE.Mesh(geometry, rightMaterial);
this.rightScreen.layers.set(2);  // å›¾å±‚ 2
this.scene.add(this.rightScreen);
```

---

### ç¬¬å…­æ­¥ï¼šThree.js å›¾å±‚ç³»ç»Ÿ

#### 6.1 å›¾å±‚é…ç½®ï¼ˆ`vr-scene.js`ï¼‰

**Three.js å›¾å±‚ç³»ç»ŸåŸç†ï¼š**
- Three.js æ”¯æŒ 32 ä¸ªå›¾å±‚ï¼ˆ0-31ï¼‰
- æ¯ä¸ªç‰©ä½“å¯ä»¥å±äºä¸€ä¸ªæˆ–å¤šä¸ªå›¾å±‚
- æ¯ä¸ªç›¸æœºå¯ä»¥é€‰æ‹©æ¸²æŸ“å“ªäº›å›¾å±‚

**WebXR ç›¸æœºç»“æ„ï¼š**
```
xrCamera (VRCamera - çˆ¶ç›¸æœº)
â”œâ”€â”€ cameras[0] (å·¦çœ¼å­ç›¸æœº)
â””â”€â”€ cameras[1] (å³çœ¼å­ç›¸æœº)
```

**é…ç½®ä»£ç ï¼š**
```javascript
configureStereoLayers() {
    const xrCamera = this.renderer.xr.getCamera();
    
    // 1. é…ç½®çˆ¶ç›¸æœºï¼šå¯ç”¨æ‰€æœ‰å›¾å±‚
    xrCamera.layers.enable(0);  // åœºæ™¯ç‰©ä½“
    xrCamera.layers.enable(1);  // å·¦çœ¼è§†é¢‘
    xrCamera.layers.enable(2);  // å³çœ¼è§†é¢‘
    
    // 2. é…ç½®å·¦çœ¼ç›¸æœºï¼šå›¾å±‚ 0 + 1
    xrCamera.cameras[0].layers.disableAll();
    xrCamera.cameras[0].layers.enable(0);
    xrCamera.cameras[0].layers.enable(1);
    
    // 3. é…ç½®å³çœ¼ç›¸æœºï¼šå›¾å±‚ 0 + 2
    xrCamera.cameras[1].layers.disableAll();
    xrCamera.cameras[1].layers.enable(0);
    xrCamera.cameras[1].layers.enable(2);
}
```

**æ¸²æŸ“ç»“æœï¼š**
```
å·¦çœ¼çœ‹åˆ°ï¼š                    å³çœ¼çœ‹åˆ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›¾å±‚ 0 (åœºæ™¯) â”‚            â”‚ å›¾å±‚ 0 (åœºæ™¯) â”‚
â”‚ +            â”‚            â”‚ +            â”‚
â”‚ å›¾å±‚ 1 (å·¦çœ¼) â”‚            â”‚ å›¾å±‚ 2 (å³çœ¼) â”‚
â”‚              â”‚            â”‚              â”‚
â”‚   ğŸŸ¥         â”‚            â”‚         ğŸŸ¥   â”‚
â”‚              â”‚            â”‚              â”‚
â”‚     ğŸ¤–       â”‚            â”‚       ğŸ¤–     â”‚
â”‚              â”‚            â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å®Œæ•´æ•°æ®æµ

```
1. PyBullet æ¸²æŸ“
   â†“
   å·¦çœ¼å›¾åƒ (640Ã—480, BGR)
   å³çœ¼å›¾åƒ (640Ã—480, BGR)

2. Side-by-Side æ‹¼æ¥
   â†“
   SBS å›¾åƒ (1280Ã—480, BGR)

3. WebRTC ç¼–ç 
   â†“
   è§†é¢‘æµ (VP8/H.264)

4. ç½‘ç»œä¼ è¾“
   â†“
   P2P è¿æ¥ (< 100ms)

5. WebRTC è§£ç 
   â†“
   HTML5 Video Element

6. Three.js VideoTexture
   â†“
   GPU çº¹ç† (1280Ã—480)

7. Shader æ‹†åˆ†
   â†“
   å·¦çœ¼çº¹ç† (é‡‡æ · U: 0.0~0.5)
   å³çœ¼çº¹ç† (é‡‡æ · U: 0.5~1.0)

8. å›¾å±‚ç³»ç»Ÿ
   â†“
   å·¦çœ¼ç›¸æœº â†’ å·¦çœ¼å±å¹• (å›¾å±‚ 1)
   å³çœ¼ç›¸æœº â†’ å³çœ¼å±å¹• (å›¾å±‚ 2)

9. VR å¤´æ˜¾æ¸²æŸ“
   â†“
   ç«‹ä½“è§†è§‰æ•ˆæœ âœ¨
```

---

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### 1. **ç³è·ï¼ˆIPDï¼‰è®¡ç®—**
- äººçœ¼å¹³å‡ç³è·ï¼š64mm
- å·¦çœ¼ä½ç½® = å¤´éƒ¨ä½ç½® - å³å‘é‡ Ã— 32mm
- å³çœ¼ä½ç½® = å¤´éƒ¨ä½ç½® + å³å‘é‡ Ã— 32mm

### 2. **å››å…ƒæ•°æ—‹è½¬**
- VR å¤´æ˜¾æœå‘ â†’ å››å…ƒæ•°
- å››å…ƒæ•° â†’ æ—‹è½¬çŸ©é˜µ
- æ—‹è½¬çŸ©é˜µ Ã— æ–¹å‘å‘é‡ = ç›¸æœºæœå‘

### 3. **UV åæ ‡æ˜ å°„**
- å·¦çœ¼ï¼š`uv.x = uv.x * 0.5`ï¼ˆé‡‡æ ·å·¦åŠéƒ¨åˆ†ï¼‰
- å³çœ¼ï¼š`uv.x = uv.x * 0.5 + 0.5`ï¼ˆé‡‡æ ·å³åŠéƒ¨åˆ†ï¼‰

### 4. **å›¾å±‚ç³»ç»Ÿ**
- çˆ¶ç›¸æœºå¿…é¡»å¯ç”¨æ‰€æœ‰å­ç›¸æœºéœ€è¦çš„å›¾å±‚
- å­ç›¸æœºç‹¬ç«‹é…ç½®å¯è§å›¾å±‚
- å®ç°å·¦å³çœ¼åˆ†ç¦»æ¸²æŸ“

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **æ¸²æŸ“åˆ†è¾¨ç‡** | 640Ã—480 (æ¯çœ¼) |
| **ä¼ è¾“åˆ†è¾¨ç‡** | 1280Ã—480 (SBS) |
| **å¸§ç‡** | 30 fps (å¯é…ç½®åˆ° 60 fps) |
| **å»¶è¿Ÿ** | < 100ms (ç«¯åˆ°ç«¯) |
| **å¸¦å®½** | ~2-5 Mbps (å–å†³äºç¼–ç ) |
| **ç‰©ç†ä»¿çœŸé¢‘ç‡** | 240 Hz |

---

## ğŸ¨ è§†è§‰æ•ˆæœ

ç”¨æˆ·åœ¨ VR å¤´æ˜¾ä¸­çœ‹åˆ°çš„æ•ˆæœï¼š

1. **ç«‹ä½“æ·±åº¦æ„Ÿ**ï¼šç”±äºå·¦å³çœ¼è§†å·®ï¼Œç‰©ä½“æœ‰æ˜æ˜¾çš„ 3D æ·±åº¦
2. **æœºå™¨äººè§†è§’**ï¼šä»æœºå™¨äººå¤´éƒ¨ä½ç½®è§‚å¯Ÿä¸–ç•Œ
3. **å½©è‰²ç«‹æ–¹ä½“**ï¼šç¯ç»•åœ¨å‘¨å›´çš„çº¢ã€ç»¿ã€è“ã€é»„è‰²ç«‹æ–¹ä½“
4. **åœ°é¢**ï¼šPyBullet æ¸²æŸ“çš„åœ°é¢å¹³é¢
5. **å®æ—¶å“åº”**ï¼šå¤´éƒ¨è½¬åŠ¨æ—¶ï¼Œè§†è§’å®æ—¶è·Ÿéš

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è§†é¢‘æµçŠ¶æ€
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°
console.log('è§†é¢‘å°ºå¯¸:', video.videoWidth, 'x', video.videoHeight);
console.log('è§†é¢‘æ’­æ”¾:', !video.paused);
console.log('å½“å‰æ—¶é—´:', video.currentTime);
```

### æŸ¥çœ‹å›¾å±‚é…ç½®
```javascript
// åœ¨ VR ä¼šè¯ä¸­
const xrCamera = renderer.xr.getCamera();
console.log('å·¦çœ¼å›¾å±‚:', xrCamera.cameras[0].layers.mask);
console.log('å³çœ¼å›¾å±‚:', xrCamera.cameras[1].layers.mask);
```

### æµ‹è¯•å›¾æ¡ˆæ¨¡å¼
```bash
# å¯åŠ¨æµ‹è¯•å›¾æ¡ˆ
python main.py --test-pattern

# åº”è¯¥çœ‹åˆ°ï¼š
# å·¦çœ¼ï¼šçº¢è‰²èƒŒæ™¯ + "LEFT EYE"
# å³çœ¼ï¼šè“è‰²èƒŒæ™¯ + "RIGHT EYE"
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **æœåŠ¡å™¨ç«¯**ï¼š
  - `virtual-robot/robot_sim.py` - åœºæ™¯è®¾ç½®
  - `virtual-robot/stereo_camera.py` - åŒç›®æ¸²æŸ“
  - `virtual-robot/webrtc_server.py` - è§†é¢‘ä¼ è¾“

- **å®¢æˆ·ç«¯**ï¼š
  - `src/vr-scene.js` - VR åœºæ™¯å’Œå›¾å±‚é…ç½®
  - `src/stereo-shader.js` - Shader æ‹†åˆ†
  - `src/webrtc-client.js` - WebRTC æ¥æ”¶
  - `main.js` - ä¸»æµç¨‹æ§åˆ¶

