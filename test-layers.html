<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾å±‚æµ‹è¯• - VR ç«‹ä½“æ¸²æŸ“</title>
    <style>
        body {
            margin: 0;
            font-family: monospace;
            background: #000;
            color: #0f0;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border: 1px solid #0f0;
            z-index: 1000;
            max-width: 600px;
        }
        #info h2 {
            margin-top: 0;
            color: #0ff;
        }
        #info pre {
            background: #111;
            padding: 10px;
            overflow-x: auto;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <div id="info">
        <h2>ğŸ” VR å›¾å±‚è¯Šæ–­å·¥å…·</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºè¯Šæ–­ PICO VR çš„å›¾å±‚ç³»ç»Ÿé—®é¢˜</p>
        <div id="status">æ­£åœ¨åˆå§‹åŒ–...</div>
        <pre id="log"></pre>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/examples/jsm/webxr/VRButton.js';

        const log = document.getElementById('log');
        const status = document.getElementById('status');

        function addLog(msg, type = 'info') {
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
            log.innerHTML += `<span class="${className}">${msg}</span>\n`;
            console.log(msg);
        }

        // åˆ›å»ºåœºæ™¯
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020);

        // åˆ›å»ºç›¸æœº
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 0);

        // åˆ›å»ºæ¸²æŸ“å™¨
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // æ·»åŠ  VR æŒ‰é’®
        document.body.appendChild(VRButton.createButton(renderer));

        // æ·»åŠ å…‰ç…§
        const light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);

        // åˆ›å»ºæµ‹è¯•ç‰©ä½“
        // å›¾å±‚ 0 - ç™½è‰²ç«‹æ–¹ä½“ï¼ˆé»˜è®¤ï¼‰
        const cube0 = new THREE.Mesh(
            new THREE.BoxGeometry(0.5, 0.5, 0.5),
            new THREE.MeshBasicMaterial({ color: 0xffffff })
        );
        cube0.position.set(0, 1.6, -2);
        cube0.layers.set(0);
        scene.add(cube0);
        addLog('âœ… åˆ›å»ºå›¾å±‚ 0 ç‰©ä½“ï¼ˆç™½è‰²ç«‹æ–¹ä½“ï¼‰');

        // å›¾å±‚ 1 - çº¢è‰²å¹³é¢ï¼ˆå·¦çœ¼ï¼‰
        const plane1 = new THREE.Mesh(
            new THREE.PlaneGeometry(1, 1),
            new THREE.MeshBasicMaterial({ color: 0xff0000, side: THREE.DoubleSide })
        );
        plane1.position.set(-1, 1.6, -2);
        plane1.layers.set(1);
        scene.add(plane1);
        addLog('âœ… åˆ›å»ºå›¾å±‚ 1 ç‰©ä½“ï¼ˆçº¢è‰²å¹³é¢ï¼‰');

        // å›¾å±‚ 2 - è“è‰²å¹³é¢ï¼ˆå³çœ¼ï¼‰
        const plane2 = new THREE.Mesh(
            new THREE.PlaneGeometry(1, 1),
            new THREE.MeshBasicMaterial({ color: 0x0000ff, side: THREE.DoubleSide })
        );
        plane2.position.set(1, 1.6, -2);
        plane2.layers.set(2);
        scene.add(plane2);
        addLog('âœ… åˆ›å»ºå›¾å±‚ 2 ç‰©ä½“ï¼ˆè“è‰²å¹³é¢ï¼‰');

        // åœ°æ¿
        const floor = new THREE.GridHelper(10, 20);
        scene.add(floor);

        let layersConfigured = false;

        // VR ä¼šè¯å¼€å§‹
        renderer.xr.addEventListener('sessionstart', () => {
            addLog('ğŸ¥½ VR ä¼šè¯å·²å¯åŠ¨', 'success');
            layersConfigured = false;
        });

        // æ¸²æŸ“å¾ªç¯
        renderer.setAnimationLoop(() => {
            // é…ç½®å›¾å±‚
            if (renderer.xr.isPresenting && !layersConfigured) {
                const xrCamera = renderer.xr.getCamera();
                
                if (xrCamera && xrCamera.cameras && xrCamera.cameras.length >= 2) {
                    addLog('ğŸ“· é…ç½®ç«‹ä½“å›¾å±‚...', 'success');
                    addLog(`   ç›¸æœºæ•°é‡: ${xrCamera.cameras.length}`);
                    
                    // å·¦çœ¼ï¼šå›¾å±‚ 0 + å›¾å±‚ 1
                    xrCamera.cameras[0].layers.disableAll();
                    xrCamera.cameras[0].layers.enable(0);
                    xrCamera.cameras[0].layers.enable(1);
                    addLog(`   å·¦çœ¼å›¾å±‚æ©ç : ${xrCamera.cameras[0].layers.mask.toString(2).padStart(8, '0')}`);
                    
                    // å³çœ¼ï¼šå›¾å±‚ 0 + å›¾å±‚ 2
                    xrCamera.cameras[1].layers.disableAll();
                    xrCamera.cameras[1].layers.enable(0);
                    xrCamera.cameras[1].layers.enable(2);
                    addLog(`   å³çœ¼å›¾å±‚æ©ç : ${xrCamera.cameras[1].layers.mask.toString(2).padStart(8, '0')}`);
                    
                    addLog('âœ… å›¾å±‚é…ç½®å®Œæˆ', 'success');
                    addLog('');
                    addLog('ğŸ“‹ é¢„æœŸæ•ˆæœ:', 'warning');
                    addLog('   - å·¦çœ¼åº”è¯¥çœ‹åˆ°: ç™½è‰²ç«‹æ–¹ä½“ + çº¢è‰²å¹³é¢');
                    addLog('   - å³çœ¼åº”è¯¥çœ‹åˆ°: ç™½è‰²ç«‹æ–¹ä½“ + è“è‰²å¹³é¢');
                    addLog('   - å¦‚æœä¸¤åªçœ¼ç›çœ‹åˆ°ç›¸åŒå†…å®¹ï¼Œè¯´æ˜å›¾å±‚ç³»ç»Ÿå¤±è´¥');
                    
                    layersConfigured = true;
                    status.innerHTML = '<span class="success">âœ… å›¾å±‚å·²é…ç½®ï¼Œè¯·æ£€æŸ¥ VR ä¸­çš„æ˜¾ç¤º</span>';
                }
            }
            
            renderer.render(scene, camera);
        });

        addLog('âœ… åˆå§‹åŒ–å®Œæˆ');
        addLog('ğŸ‘‰ ç‚¹å‡» "ENTER VR" æŒ‰é’®å¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>

